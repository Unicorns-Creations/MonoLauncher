<!DOCTYPE html>
<html>


<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="imsg.css">
  <script src="https://kit.fontawesome.com/2c4b435336.js" crossorigin="anonymous"></script>
  <script src="imsg.js" crossorigin="anonymous"></script>
</head>

<header>
  <div id="header-root"></div>
</header>

<body>
  <span id="actionBar"><a onclick="window.location.href='../../monotablet.html'"><i
        class="fas fa-chevron-circle-left"></i></a> 100% <i class="fas fa-battery-full"></i> <i class="fas fa-wifi"></i>
    <span id="timeNow">00:00:00</span></span>
  <script>
    const {
      ipcRenderer
    } = require('electron');

    function currentTime() {
      var date = new Date();
      var hour = date.getHours();
      var min = date.getMinutes();
      var sec = date.getSeconds();
      hour = updateTime(hour);
      min = updateTime(min);
      sec = updateTime(sec);
      document.getElementById("timeNow").innerText = hour + ":" + min + ":" + sec;
      var t = setTimeout(function () {
        currentTime()
      }, 1000);
    }

    function updateTime(k) {
      if (k < 10) {
        return "0" + k;
      } else {
        return k;
      }
    }

    currentTime();
  </script>

  <div id="participants">
    <input id="search">
    <button onclick="createMsg()">New Msg</button>
  </div>

  <div id="messages">
    <div id="messageAuthor">
      <img id="AuthorAvatar" src="../../imgs/squestion.jpg">
      <h2 id="AuthorName">WIP</h2>
    </div>
    <div id="messageContainer">

    </div>

  </div>

  <script>
    function map(fn, map) {
      if (typeof thisArg !== 'undefined')
        fn = fn.bind(thisArg);
      const iter = map.entries();
      return Array.from({
        length: map.size
      }, () => {
        const [key, value] = iter.next().value;
        return fn(value, key, this);
      });
    }

    function createNew(name) {
      var pParent = document.getElementById("participants");
      var pNew = document.createElement("li");
      var pAvatar = document.createElement("img");
      var pName = document.createElement("span")

      pAvatar.src = "../../imgs/squestion.jpg";
      pAvatar.id = "participantAvatar";
      pName.className = "participantName";
      pName.innerHTML = ` ${name}`;

      pNew.appendChild(pAvatar);
      pNew.appendChild(pName);
      pParent.appendChild(pNew);
    }
    ipcRenderer.invoke('request-imsgs').then(function (result) {
      if (result == "404") {
        createNew("Couldn't find Gmod")
      }
      map(f => f.name, result).forEach(name => {
        createNew(name)
      })
    });

    function createMsg() {
      var mParent = document.getElementById("messages");
      var mNew = document.createElement("li");

      mNew.innerHTML =
        "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed quis metus quis eros suscipit suscipit eu rhoncus metus. Etiam rutrum iaculis sollicitudin. Praesent lacus purus, hendrerit in felis nec, feugiat ultrices nisi. Maecenas lacinia diam enim, scelerisque porta purus placerat nec. Maecenas eu libero hendrerit, placerat nulla quis, suscipit urna. Morbi ornare metus sit amet suscipit imperdiet. Pellentesque lorem quam, suscipit quis blandit id, egestas nec massa. Sed laoreet nunc et lacus congue faucibus. Integer mattis justo vitae maximus pellentesque. Nunc sit amet tellus commodo, euismod nisl ut, consectetur libero. Mauris mattis neque in elit placerat varius. Quisque gravida magna mauris, in feugiat dolor mollis ac. Vestibulum hendrerit massa non ligula interdum, ac dapibus lacus luctus. Suspendisse velit nisi, consectetur ac fringilla in, aliquam et quam. Maecenas nunc quam, placerat vitae est vel, cursus rhoncus massa. In condimentum felis augue, nec rhoncus velit ornare vel."

      mParent.appendChild(mNew);
    }
  </script>

</body>


</html>